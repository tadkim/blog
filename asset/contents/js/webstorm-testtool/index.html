<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
</head>
<body>
<h1 id="웹스톰과테스트도구">웹스톰과 테스트도구</h1>

<p>자바스크립트를 테스트하려면 테스트 프레임워크를 선택해야한다. 이 책에서 소개하는 QUnit은 네이버에서 사용하는 테스트 프레임웍이다.</p>

<p><strong>QUnit의 특징</strong></p>

<ul>
<li>간단한 방법과 메서드로 사용할 수 있음</li>
<li>비동기 테스트에도 대응하고 있음</li>
<li>웹 서버 없이도 테스트 실행 결과를 웹페이지에서 볼 수 있음</li>
<li>QUnit-TAP을 이용하면 명령줄에서도 테스트를 실행할 수 있다.

<ul>
<li>TAP은 Test Anything Protocol의 약자로 테스트 프로토콜이다. 따라서 TAP을 기반으로 한 기존 도구를 함께 사용할 수 있다.</li>
</ul></li>
<li>QUnit은 CommonJS의 표준을 따르고 있으므로 서버 사이드 자바스크립트인 Node.js에서도 사용할 수 있다.</li>
<li>자세한 설명은 부록A 의 QUnit기능소개(356쪽) 참고하자.</li>
</ul>

<p><strong>카르마</strong></p>

<p>이 도구 자체는 테스트 실행 환경이므로 Jasmine<sup><a href="#fn:1" id="fnref:1" title="see footnote" class="footnote">1</a></sup>이나 Mocha<sup><a href="#fn:2" id="fnref:2" title="see footnote" class="footnote">2</a></sup>, QUnit등의 테스트 프레임워크를 사용해 테스트 코드를 작성해야 한다.</p>

<blockquote>
<p>웹스톰 7부터 카르마를 지원하면서 네이버에서도 관심을 가졌고, 웹스톰의 막강한 매력에 빠졌다고한다. 프런트엔드 개발 IDE에서 카르마를 지원한다는 것은 테스트 실행 환경 도구가 프런트엔드 개발에 얼마나 중요한 역할을 하는지 가늠할 수 있게 한다.</p>
</blockquote>

<h2 id="웹스톰과카르마">웹스톰과 카르마</h2>

<hr />

<h3 id="카르마설치">카르마 설치</h3>

<p>카르마는 테스트 실행 환경이다. 즉, 테스트 코드를 자동으로 실행하고 결과물을 산출하는 역할을 한다. 테스트 코드는 테스트 프레임워크를 이용해 작성한다. 단위 테스트 코드 또는 테스트 주도 개발로 작성된 테스트 코드가 필요하다. </p>

<blockquote>
<p>이 책에서는 웹스톰에서 카르마를 실행해보며 테스트하는 방법을 간단히설명하며, 테스트 주도 개발 방법은 자세히 설명하지 않는다. </p>
</blockquote>

<ol>
<li><a href="https://github.com/wikibook/frontenddevelopment/tree/master/4장/2.test_code/test">예제 파일 다운로드</a>

<ol>
<li>이 테스트 코드는 QUnit 프레임 워크를 사용해 작성한 Spinbox 테스트 코드다.</li>
</ol></li>
<li>다운로드가 완료되었으면 웹스톰에서 열어본다.</li>
</ol>

<hr />

<h3 id="웹스톰과카르마-카르마설치"><strong>웹스톰과 카르마 - 카르마 설치</strong></h3>

<figure>
<img src="http://whiteleo.azurewebsites.net/colony/markdown/jslint/QUnit_418.png" alt="그림1-1 Webstorm, QUnit 1 " title="그림1-1 Webstorm, QUnit 1 " />
<figcaption>그림1&#8211;1 Webstorm, QUnit 1 </figcaption>
</figure>

<p>지난 번에 살펴본 JSLint를 활성화 해보고, 같은 방법으로 predefined에 QUnit과 QUnit의 메서드인 equal을 등록해본다.</p>

<p>결과를 살펴보면, 검증오류는 없어지지만 QUnit을 인식할 수 없다는 경고메시지는 여전지 남아있게된다. </p>

<p><strong>자바스크립트 라이브러리 등록하기</strong></p>

<p><strong>QUnit과 같은 라이브러리는 웹스톰에서 종종 인식되지 않는다</strong>. 이로인한 문제를 해결 하기위해 [<strong>자바스크립틀 라이브러리 등록</strong>]을 해준다. 이 등록을 해주면, 웹스톰에서 자바스크립트 라이브러리를 인식할 뿐 아니라, 자동 완성이나 파라미터 타입 검증 등 여러가지 편리한 기능을 사용할 수 있다. </p>

<ol>
<li>Preferences &gt; Javascript &gt; Libraries</li>
<li>Libraries 설정 뷰에서 Download를 클릭</li>
</ol>

<figure>
<img src="http://whiteleo.azurewebsites.net/colony/markdown/jslint/QUnit_420.png" alt="그림1-2 Webstorm, 자바스크립트 라이브러리 등록화면 " title="그림1-1 Webstorm, 자바스크립트 라이브러리 등록화면 " />
<figcaption>그림1&#8211;2 Webstorm, 자바스크립트 라이브러리 등록화면 </figcaption>
</figure>

<p>이렇게 자바스크립트 라이브러리 까지 등록한 후, JSLint의 코드힌팅 결과를 살펴보면서 나머지 Typo에 대해서는 각자 스스로 Intention actions suggested를 이용해 사전에 등록한다.</p>

<p><strong>본격적으로 카르마 실행하기</strong></p>

<ol>
<li>npm<sup><a href="#fn:1" title="see footnote" class="footnote">1</a></sup>의 package.son 파일을 생성해야 한다.</li>
<li>웹스톰의 좌측 하단에 숨겨진 도구창 <strong>’ㅁ’</strong>에 마우스를 올리고 Terminal을 클릭해 터미널 도구 창을 연다.</li>
</ol>

<figure>
<img src="http://whiteleo.azurewebsites.net/colony/markdown/jslint/QUnit_423.png" alt="그림1-3 Webstorm, 숨겨진 도구창 열기 " title="그림1-1 Webstorm, 숨겨진 도구창 열기 " />
<figcaption>그림1&#8211;3 Webstorm, 숨겨진 도구창 열기 </figcaption>
</figure>

<p>터미널 도구창에서 npm init 명령어를 입력하면 몇가지 질문을 하는데 다음과 같이 작성한다.</p>

<p>$npm init</p>

<pre><code>name:(Spinbox) Spinbox
version : (0.0.0) 0.0.1
description : 자바스크립트 스핀박스 모듈
entry point : (index.js)
test command : node_modules/karma/bin/karma start
git repository : 
keywords : 
author : 
license : (ISC) MIT
</code></pre>

<p>프로젝트 뷰를 보면 package.son 파일이 생성됐을 것이다. 다음으로 카르마를 설치한다. nam 파라미터로 ‘—save-dev’를 입력해 packge.json의 devDependencies 속성에 다음과 같이 카르마를 작성한다.</p>

<p><strong>모든 질문에 답변을 완료하면 프로젝트폴더에 karma.conf.js 파일이 생성된다</strong>. 그리고 입력값에 따라서 package.json에도 카르마에서 의존하는 여러가지 모듈이 작성된다.</p>

<h2 id="테스트실행">테스트 실행</h2>

<p><strong>테스트를 실행하려면 karma.conf.json 파일을 Run/Debug로 등록해야 한다</strong>. Karma.conf.js 파일에서 RC 후 Create ‘karma.conf.js’를 클릭한다.</p>

<figure>
<img src="http://whiteleo.azurewebsites.net/colony/markdown/jslint/karma_test1.png" alt="그림1-4 Webstorm, karma test play 결과화면 " title="그림1-1 Webstorm, karma test play 결과화면 " />
<figcaption>그림1&#8211;4 Webstorm, karma test play 결과화면 </figcaption>
</figure>

<p>웹스톰의 오른쪽 위에있는 재생버튼을 클릭해 카르마를 실행해보면 우리가 karma.conf.js의 brosers 속성에 등록된 크롬과 파이어폭스 브라우저를 자동으로 실행시켜서 테스트를 진행한다. </p>

<p>먼저 Spinbox View에서 실패하는 테스트를 살펴보도록 하자.</p>

<figure>
<img src="http://whiteleo.azurewebsites.net/colony/markdown/jslint/karma_test2.png" alt="그림1-4 Webstorm, karma test play 결과화면 " title="그림1-1 Webstorm, karma test 2 " />
<figcaption>그림1&#8211;4 Webstorm, karma test play 결과화면 </figcaption>
</figure>

<p>UI 테스트를 하기 위해 <strong>karma-html2js-preprocessor</strong> 모듈을 사용해 HTML 파일을 로드하도록 테스트 코드를 작성한다. 하지만 해당 모듈이 없어 HTML 파일이 로드되지 않으므로 제대로 동작하지 않는다. 터미널 도구 창을 열고 아래 명령어로 karma-html2js-preprocessor모듈을 설치한다.</p>

<pre><code>    $npm install —save-dev karma-html2js-preprocessor
</code></pre>

<p><strong>karma-html2js-preprocessor 모듈을 사용해 UI 테스트에 필요한 HTML 파일을 로드하도록 karma.conf.js 파일을 다시 작성한다</strong>. <em>참고로 karma.conf.js 파일은 Node.js 파일이므로 Libraries 설정 뷰에서 Node Core Modules와 Node.js Globals를 선택하는 것이 좋다.</em></p>

<h2 id="커버리지coverage">커버리지(coverage)</h2>

<hr />

<p>테스트할 때 잊지 말아야할 중요한 척도가 있는데 바로 커버리지다. <strong>커버리지란 제품 코드를 테스트 코드로 얼마나 커버하고 있는지 즉, 얼마나 테스트로 검증하고 있는지를 수치로 나타낸 것을 말한다</strong>. 예를 들어 커버리지가 50%라면 제품 코드중 50%만 테스트하고 있다는 뜻이다.</p>

<p>카르마로 커버리를 측정하려면 모듈을 설치한다. 터미널 도구 창을 열고 아래의 명령어를 입력한다.</p>

<pre><code>    $npm install —save—dev karma-coverage
</code></pre>

<figure>
<img src="http://whiteleo.azurewebsites.net/colony/markdown/jslint/karma_test_428.png" alt="그림1-5 Webstorm, karma html2js preprocessor 설치 후 화면" title="그림1-5 Webstorm, karma html2js preprocessor 설치 후 화면 " />
<figcaption>그림1&#8211;5 Webstorm, karma html2js preprocessor 설치 후 화면</figcaption>
</figure>

<p>책에서는(90p)에서는 Firefox 브라우저에서만 실패한 ’Spinbox Model’로 정리가 되고있지만, 설명되어있는 대로 karma.conf.js를 수정하니, 위 사진과 같이 전체 코드가 ‘passed’라는 평가를 받았다. </p>

<hr />

<h1 id="웹스톰과커버리지">웹스톰과 커버리지</h1>

<p><strong>Coverage</strong></p>

<p>테스트를 할 때 잊지 말아야 할 중요한 척도가 있는데, 바로 커버리지다. <strong>커버리지란 제품 코드를 테스트 코드로 얼마나 커버하고 있는지 즉, 얼마나 테스트로 검증하고 있는지를 수치로 나타낸 것을 말한다</strong>. </p>

<p>예를 들어 커버리지가 50%라면 제품 코드 중 50%만 테스트하고 있다는 뜻이다.</p>

<p><strong>카르마로 커버리지를 측정하려면 먼저 모듈을 설치한다</strong>.</p>

<figure>
<img src="http://whiteleo.azurewebsites.net/colony/markdown/jslint/karma_test_4.png" alt="그림1-6 Webstorm, karma coverage " title="그림1-5 Webstorm, karma coverage " />
<figcaption>그림1&#8211;6 Webstorm, karma coverage </figcaption>
</figure>

<p>중요한 것은 이제까지 실행 했던 ‘RUN’기능이 아닌 ‘Run with Coverage’로 실행된다는 점이다. 이로써 테스트를 다시 실행하고 커버리지를 측정한다.</p>

<p>또한 프로젝트뷰에서 파일별로 커버리지 상태를 바로 알 수 있게 커버리지 정보가 추가됐다.<em>(파일 명 옆에 %로 표시되어 있는 것이 커버리지 값이다.)</em></p>

<p><strong>이 밖에, 커버리지 관련 다양한 정보를 얻을 수 있다</strong>.</p>

<p>커버리지를 실행하면 산출물이 coverage 디렉터리에 저장되는데 index.html을 실행하면 커버리지 비율 외에도 다음 항목에 대한 내용을 상세하게 얻을 수 있다.</p>

<ul>
<li><strong>구문(Statements</strong>) : 전체 소스 코드 중에서 테스트로 실행된 문장의 비율</li>
<li><strong>분기(Branches</strong>) : 전체 소스 코드 중에서 테스트로 실행된 경로의 비율</li>
<li><strong>함수(Functions</strong>) : 전체 함수 중에서 테스트로 호출된 함수의 비율</li>
<li><strong>경로(Lines</strong>) : 전체 소스 코드의 실행 가능한 모든 경로 중에서 테스트로 실행된 경로의 비율</li>
</ul>

<p><strong>04 코드 품질 관리 마무리</strong></p>

<hr />

<p>이번 장에서는 웹스톰에서 JSLint를 이용해 실시간으로 코드를 검증하는 방법과 카르마를 이용해 테스트 코드를 실행하는 방법을 알아봤다.</p>

<ul>
<li><p><strong>JSLint 검증에 실패하는 코드 중에는 자바스크립트 실행 자체가 안 되는 것도 있고 실행은 되지만 잘못된 동작을 일으키는 것도 있다</strong>. 전자의 경우가 후자의 경우보다 훨씬 낫다. 전자의 경우는 브라우저에서 실행하면 바로 문제가 있음을 알 수 있지만 후자의 경우에는 언제, 어떻게 문제가 발생할지 아무도 모르기 때문이다.</p></li>
<li><p><strong>자바스크립트가 처음 탄생했던 시기부터 몇 년간은 자바스크립트 코드는 품질 검증 단계가 필요 없었다</strong>. 이유는 생명 주기가 아주 짧았기 때문이다. 하지만 이제는 다르다. 지금 개발하는 자바스크립트 코드가 10년 뒤에도 사용될 수 있기 때문에 품질 검증은 필수가 됐다.</p></li>
<li></li>
<li><p><strong>품질 검증만으로 방어할 수 없는 부분이 존재한다</strong>. 바로 서비스 요구사항이다. 이것을 명세라고도 한다. 어떻게 동작해야하는지 명시하고 있기 때문에 요구사항대로 동작하는 코드를 구현하는 것이 아주 중요하다. 하지만 코드를 추가하거나 수정했을 때 기존의 요구사항을 구현한 로직을 변화시키는 부작용이 발생한다. 어떤 기능을 추가하고 기존의 기능에 문제가 없는지 밤새워가며 테스트할 수는 없는 일이다. <strong>이제 자바스크립트는 QUnit, 카르마 등과 함께 충분히 테스트를 작성하고 실행할수 있는 라이브러리와 발전된 환경을 제공한다. 더 이상 자바스크립트의 검증과 단위 테스트를 게을리 해서는 안 될 것이다</strong>.</p></li>
</ul>

<div class="footnotes">
<hr />
<ol>

<li id="fn:1">
<p>웹스톰설치(36쪽)절에서 소개했으니 참고한다. <a href="#fnref:1" title="return to article" class="reversefootnote">&#8617;&#xFE0E;</a></p>
</li>

<li id="fn:2">
<p>2 <a href="#fnref:2" title="return to article" class="reversefootnote">&#8617;&#xFE0E;</a></p>
</li>

</ol>
</div>


</body>
</html>